# Documentaci√≥n: Commands vs DTOs - Diferencias y Cu√°ndo Usar Cada Uno

## üìã √çndice
1. [Introducci√≥n](#introducci√≥n)
2. [¬øQu√© son los Commands?](#qu√©-son-los-commands)
3. [¬øQu√© son los DTOs?](#qu√©-son-los-dtos)
4. [Diferencias Clave](#diferencias-clave)
5. [Flujo Completo: Command ‚Üí DTO](#flujo-completo-command--dto)
6. [Casos de Uso Espec√≠ficos](#casos-de-uso-espec√≠ficos)
7. [Ejemplos Pr√°cticos](#ejemplos-pr√°cticos)
8. [Cu√°ndo usar cada uno](#cu√°ndo-usar-cada-uno)
9. [Mejores Pr√°cticas](#mejores-pr√°cticas)
10. [Resumen y Recomendaciones](#resumen-y-recomendaciones)

---

## üéØ Introducci√≥n

Una de las confusiones m√°s comunes en la arquitectura DDD es entender la diferencia entre **Commands** y **DTOs**. Ambos transportan datos, pero tienen prop√≥sitos y momentos de uso completamente diferentes.

### **El problema com√∫n:**
- **Commands** ‚Üí Transportan datos
- **DTOs** ‚Üí Transportan datos
- **¬øCu√°l usar?** ü§î

**La respuesta:** Depende del **momento** y **direcci√≥n** del flujo de datos.

---

## üéØ ¬øQu√© son los Commands?

### **Definici√≥n:**
Un **Command** es un objeto que representa una **intenci√≥n** o **acci√≥n** que el usuario quiere ejecutar en el sistema. Transporta los **datos de entrada** necesarios para realizar una operaci√≥n.

### **Caracter√≠sticas:**
- **Datos de entrada**: Lo que el usuario quiere hacer
- **Antes del procesamiento**: Se usan antes de ejecutar la acci√≥n
- **Del usuario al sistema**: Van del frontend al backend
- **Inmutables**: No cambian despu√©s de ser creados

### **Analog√≠a de la Vida Real:**
Los **Commands** son como **√≥rdenes de trabajo** en una f√°brica:

- **Orden de Producci√≥n**: "Fabricar 100 sillas de madera"
- **Orden de Mantenimiento**: "Reparar la m√°quina X"
- **Orden de Env√≠o**: "Enviar pedido #12345 a la direcci√≥n Y"

Cada orden contiene **toda la informaci√≥n necesaria** para ejecutar la tarea, pero **no ejecuta la tarea** por s√≠ misma.

---

## üéØ ¬øQu√© son los DTOs?

### **Definici√≥n:**
Un **DTO** (Data Transfer Object) es un objeto que se usa para **transferir datos** entre diferentes capas de la aplicaci√≥n. Transporta los **datos de salida** despu√©s de procesar una acci√≥n.

### **Caracter√≠sticas:**
- **Datos de salida**: El resultado del procesamiento
- **Despu√©s del procesamiento**: Se usan despu√©s de ejecutar la acci√≥n
- **Del sistema al usuario**: Van del backend al frontend
- **Serializables**: Se pueden convertir a JSON/XML

### **Analog√≠a de la Vida Real:**
Los **DTOs** son como **reportes de trabajo** en una f√°brica:

- **Reporte de Producci√≥n**: "Se fabricaron 100 sillas exitosamente"
- **Reporte de Mantenimiento**: "M√°quina X reparada, tiempo: 2 horas"
- **Reporte de Env√≠o**: "Pedido #12345 enviado, tracking: ABC123"

Cada reporte contiene **el resultado** del trabajo realizado.

---

## üîç Diferencias Clave

| Aspecto | Commands | DTOs |
|---------|----------|------|
| **Prop√≥sito** | Datos de entrada | Datos de salida |
| **Cu√°ndo se usan** | Antes de procesar | Despu√©s de procesar |
| **De d√≥nde vienen** | Usuario/Frontend | Handler/Service |
| **A d√≥nde van** | Handler | Usuario/Frontend |
| **Contienen** | Lo que el usuario quiere | Lo que el sistema devuelve |
| **Ejemplo** | "Crear empleado Juan" | "Empleado Juan creado con ID 123" |
| **Momento** | Al inicio del flujo | Al final del flujo |
| **Direcci√≥n** | Usuario ‚Üí Sistema | Sistema ‚Üí Usuario |

---

## üîÑ Flujo Completo: Command ‚Üí DTO

### **1. Usuario env√≠a petici√≥n HTTP:**
```json
POST /api/employees
{
    "first_name": "Juan",
    "last_name": "P√©rez",
    "email": "juan@email.com"
}
```

### **2. Controller crea Command:**
```php
class EmployeeController {
    public function store(CreateEmployeeRequest $request) {
        // Command = Datos de ENTRADA
        $command = new CreateEmployeeCommand(
            firstName: $request->input('first_name'),  // ‚Üê Del usuario
            lastName: $request->input('last_name'),    // ‚Üê Del usuario
            email: $request->input('email')            // ‚Üê Del usuario
        );
        
        // Pasar al Handler
        $handler = app(CreateEmployeeHandler::class);
        $dto = $handler->handle($command);
        
        // Retornar DTO como respuesta
        return response()->json(['data' => $dto->toArray()], 201);
    }
}
```

### **3. Handler procesa Command y crea DTO:**
```php
class CreateEmployeeHandler {
    public function handle(CreateEmployeeCommand $command): EmployeeDTO {
        // 1. Procesar Command (datos de entrada)
        $employee = new Employee(
            id: Str::uuid()->toString(),           // ‚Üê Generado por el sistema
            firstName: $command->firstName,        // ‚Üê Del Command
            lastName: $command->lastName,          // ‚Üê Del Command
            email: new Email($command->email),     // ‚Üê Del Command
            status: EmployeeStatus::ACTIVE,        // ‚Üê Asignado por el sistema
            createdAt: new \DateTimeImmutable(),   // ‚Üê Generado por el sistema
            updatedAt: new \DateTimeImmutable()    // ‚Üê Generado por el sistema
        );
        
        // 2. Guardar en base de datos
        $this->employeeRepository->save($employee);
        
        // 3. Crear DTO (datos de salida)
        $dto = new EmployeeDTO(
            id: $employee->id(),                   // ‚Üê Generado por el sistema
            firstName: $employee->firstName(),     // ‚Üê Del Command
            lastName: $employee->lastName(),       // ‚Üê Del Command
            email: $employee->email()?->value(),   // ‚Üê Del Command
            status: $employee->status()->value,    // ‚Üê Asignado por el sistema
            createdAt: $employee->createdAt()->format('Y-m-d H:i:s'), // ‚Üê Generado por el sistema
            updatedAt: $employee->updatedAt()->format('Y-m-d H:i:s')  // ‚Üê Generado por el sistema
        );
        
        return $dto;
    }
}
```

### **4. Respuesta HTTP:**
```json
{
    "data": {
        "id": "123e4567-e89b-12d3-a456-426614174000",
        "first_name": "Juan",
        "last_name": "P√©rez",
        "email": "juan@email.com",
        "status": "active",
        "created_at": "2023-01-01 10:00:00",
        "updated_at": "2023-01-01 10:00:00"
    }
}
```

---

## üìã Casos de Uso Espec√≠ficos

### **Commands - Para acciones del usuario:**
```php
// Usuario quiere crear empleado
CreateEmployeeCommand

// Usuario quiere actualizar empleado
UpdateEmployeeCommand

// Usuario quiere eliminar empleado
DeleteEmployeeCommand

// Usuario quiere procesar n√≥mina
ProcessPayrollCommand

// Usuario quiere generar reporte
GenerateReportCommand
```

### **DTOs - Para respuestas del sistema:**
```php
// Sistema devuelve empleado creado
EmployeeDTO

// Sistema devuelve lista de empleados
EmployeeListDTO

// Sistema devuelve reporte generado
EmployeeReportDTO

// Sistema devuelve resumen
EmployeeSummaryDTO

// Sistema devuelve resultado de b√∫squeda
EmployeeSearchDTO
```

---

## üí° Ejemplos Pr√°cticos

### **Ejemplo 1: Crear Empleado**

#### **Command (Entrada):**
```php
// app/Modules/Employees/Application/Commands/CreateEmployeeCommand.php
final class CreateEmployeeCommand
{
    public function __construct(
        public readonly string $firstName,
        public readonly string $lastName,
        public readonly string $email,
        public readonly ?string $phone
    ) {}
}
```

#### **DTO (Salida):**
```php
// app/Modules/Employees/Application/DTOs/EmployeeDTO.php
final class EmployeeDTO
{
    public function __construct(
        public readonly string $id,
        public readonly string $firstName,
        public readonly string $lastName,
        public readonly string $email,
        public readonly ?string $phone,
        public readonly string $status,
        public readonly string $createdAt,
        public readonly string $updatedAt
    ) {}
}
```

#### **Flujo completo:**
```php
// 1. Usuario env√≠a datos
POST /api/employees
{
    "first_name": "Juan",
    "last_name": "P√©rez",
    "email": "juan@email.com"
}

// 2. Controller crea Command
$command = new CreateEmployeeCommand(
    firstName: "Juan",
    lastName: "P√©rez",
    email: "juan@email.com"
);

// 3. Handler procesa y crea DTO
$dto = new EmployeeDTO(
    id: "123",
    firstName: "Juan",
    lastName: "P√©rez",
    email: "juan@email.com",
    status: "active",
    createdAt: "2023-01-01 10:00:00",
    updatedAt: "2023-01-01 10:00:00"
);

// 4. Usuario recibe respuesta
{
    "data": {
        "id": "123",
        "first_name": "Juan",
        "last_name": "P√©rez",
        "email": "juan@email.com",
        "status": "active",
        "created_at": "2023-01-01 10:00:00",
        "updated_at": "2023-01-01 10:00:00"
    }
}
```

### **Ejemplo 2: Procesar N√≥mina**

#### **Command (Entrada):**
```php
// app/Modules/Payroll/Application/Commands/ProcessPayrollCommand.php
final class ProcessPayrollCommand
{
    public function __construct(
        public readonly string $employeeId,
        public readonly string $period,
        public readonly int $hoursWorked,
        public readonly float $hourlyRate
    ) {}
}
```

#### **DTO (Salida):**
```php
// app/Modules/Payroll/Application/DTOs/PayrollDTO.php
final class PayrollDTO
{
    public function __construct(
        public readonly string $payrollId,
        public readonly string $employeeId,
        public readonly string $period,
        public readonly float $grossSalary,
        public readonly float $taxes,
        public readonly float $deductions,
        public readonly float $netSalary,
        public readonly string $status,
        public readonly string $processedAt
    ) {}
}
```

#### **Flujo completo:**
```php
// 1. Usuario env√≠a datos
POST /api/payroll/process
{
    "employee_id": "123",
    "period": "2023-01",
    "hours_worked": 40,
    "hourly_rate": 25.50
}

// 2. Controller crea Command
$command = new ProcessPayrollCommand(
    employeeId: "123",
    period: "2023-01",
    hoursWorked: 40,
    hourlyRate: 25.50
);

// 3. Handler procesa y crea DTO
$dto = new PayrollDTO(
    payrollId: "PAY-456",
    employeeId: "123",
    period: "2023-01",
    grossSalary: 1020.00,
    taxes: 204.00,
    deductions: 100.00,
    netSalary: 716.00,
    status: "processed",
    processedAt: "2023-01-01 10:00:00"
);

// 4. Usuario recibe respuesta
{
    "data": {
        "payroll_id": "PAY-456",
        "employee_id": "123",
        "period": "2023-01",
        "gross_salary": 1020.00,
        "taxes": 204.00,
        "deductions": 100.00,
        "net_salary": 716.00,
        "status": "processed",
        "processed_at": "2023-01-01 10:00:00"
    }
}
```

---

## üéØ Cu√°ndo usar cada uno

### **‚úÖ Commands - Usar cuando:**
- El usuario quiere **hacer algo**
- Necesitas **datos de entrada**
- Antes de **procesar** la acci√≥n
- Del **frontend al backend**

### **‚úÖ DTOs - Usar cuando:**
- El sistema **devuelve algo**
- Necesitas **datos de salida**
- Despu√©s de **procesar** la acci√≥n
- Del **backend al frontend**

### **‚ùå NO uses Commands cuando:**
- Necesitas devolver datos al usuario
- Despu√©s de procesar una acci√≥n
- Para respuestas de API

### **‚ùå NO uses DTOs cuando:**
- Necesitas datos de entrada del usuario
- Antes de procesar una acci√≥n
- Para comandos del usuario

---

## üé® Mejores Pr√°cticas

### **1. Naming consistente:**
```php
// ‚úÖ BIEN - Naming consistente
CreateEmployeeCommand ‚Üí EmployeeDTO
UpdateEmployeeCommand ‚Üí EmployeeDTO
DeleteEmployeeCommand ‚Üí void (no DTO)
ProcessPayrollCommand ‚Üí PayrollDTO

// ‚ùå MAL - Naming inconsistente
CreateEmployeeCommand ‚Üí EmployeeData
UpdateEmployeeCommand ‚Üí EmployeeResponse
DeleteEmployeeCommand ‚Üí EmployeeDTO
```

### **2. Commands espec√≠ficos:**
```php
// ‚úÖ BIEN - Commands espec√≠ficos
CreateEmployeeCommand
UpdateEmployeeCommand
DeleteEmployeeCommand

// ‚ùå MAL - Command gen√©rico
EmployeeCommand
```

### **3. DTOs espec√≠ficos:**
```php
// ‚úÖ BIEN - DTOs espec√≠ficos
EmployeeDTO
EmployeeListDTO
EmployeeReportDTO

// ‚ùå MAL - DTO gen√©rico
GenericDTO
```

### **4. Flujo claro:**
```php
// ‚úÖ BIEN - Flujo claro
Controller ‚Üí Command ‚Üí Handler ‚Üí DTO ‚Üí Controller ‚Üí Response

// ‚ùå MAL - Flujo confuso
Controller ‚Üí DTO ‚Üí Handler ‚Üí Command ‚Üí Controller ‚Üí Response
```

---

## üìä Resumen Visual

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        FLUJO DE DATOS                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Usuario ‚Üí Controller ‚Üí Command ‚Üí Handler ‚Üí DTO ‚Üí Controller ‚Üí Usuario
   ‚Üì         ‚Üì          ‚Üì         ‚Üì       ‚Üì        ‚Üì         ‚Üì
 Frontend   HTTP    Entrada   Proceso  Salida   HTTP    Frontend
```

### **Commands (Entrada):**
- **Momento**: Al inicio
- **Direcci√≥n**: Usuario ‚Üí Sistema
- **Contenido**: Lo que el usuario quiere
- **Ejemplo**: "Crear empleado Juan"

### **DTOs (Salida):**
- **Momento**: Al final
- **Direcci√≥n**: Sistema ‚Üí Usuario
- **Contenido**: Lo que el sistema devuelve
- **Ejemplo**: "Empleado Juan creado con ID 123"

---

## üìù Resumen y Recomendaciones

### **üéØ Commands:**
- **¬øQu√©?** Datos de entrada del usuario
- **¬øCu√°ndo?** Antes de procesar
- **¬øD√≥nde?** Del usuario al sistema
- **¬øPara qu√©?** Ejecutar acciones

### **üéØ DTOs:**
- **¬øQu√©?** Datos de salida del sistema
- **¬øCu√°ndo?** Despu√©s de procesar
- **¬øD√≥nde?** Del sistema al usuario
- **¬øPara qu√©?** Mostrar resultados

### **üí° Regla Pr√°ctica:**
- **¬øEl usuario quiere hacer algo?** ‚Üí **Command**
- **¬øEl sistema devuelve algo?** ‚Üí **DTO**

### **‚úÖ Mejores pr√°cticas:**
- Commands espec√≠ficos para cada acci√≥n
- DTOs espec√≠ficos para cada respuesta
- Naming consistente
- Flujo claro y l√≥gico

**Commands y DTOs trabajan juntos para crear un flujo de datos claro y mantenible en la arquitectura DDD.**
