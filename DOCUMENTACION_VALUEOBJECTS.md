# Documentaci√≥n: ValueObjects (Objetos de Valor) - Gu√≠a Completa

## üìã √çndice
1. [¬øQu√© son los ValueObjects?](#qu√©-son-los-valueobjects)
2. [Caracter√≠sticas principales](#caracter√≠sticas-principales)
3. [¬øPor qu√© parecen "in√∫tiles"?](#por-qu√©-parecen-in√∫tiles)
4. [Valor agregado real](#valor-agregado-real)
5. [Casos de uso t√≠picos](#casos-de-uso-t√≠picos)
6. [Casos de uso espec√≠ficos del negocio](#casos-de-uso-espec√≠ficos-del-negocio)
7. [Ciclo de vida en peticiones HTTP](#ciclo-de-vida-en-peticiones-http)
8. [Mejores pr√°cticas](#mejores-pr√°cticas)
9. [Testing de ValueObjects](#testing-de-valueobjects)
10. [Relaci√≥n con otras capas](#relaci√≥n-con-otras-capas)
11. [Ejemplos pr√°cticos](#ejemplos-pr√°cticos)
12. [Resumen](#resumen)

---

## üéØ ¬øQu√© son los ValueObjects?

### **Definici√≥n:**
Los **ValueObjects** son objetos que representan **conceptos del negocio** que no tienen identidad √∫nica. Se identifican por su **valor**, no por su identidad.

### **Caracter√≠sticas principales:**
- **No tienen identidad** √∫nica (ID)
- **Son inmutables** (no cambian)
- **Se comparan** por valor, no por referencia
- **Representan conceptos** del negocio
- **Son reutilizables** y seguros

### **Analog√≠a de la Vida Real:**
Los **ValueObjects** son como **"conceptos"** en la vida real:

- **$100 USD** - Es el mismo valor sin importar el billete
- **"juan@email.com"** - Es el mismo email sin importar c√≥mo se escriba
- **"123-45-6789"** - Es el mismo n√∫mero de tel√©fono
- **"Activo"** - Es el mismo estado sin importar cu√°ndo se use

---

## üß© Caracter√≠sticas principales

### **1. No tienen identidad √∫nica:**
```php
// ‚úÖ BIEN - ValueObject sin ID
class Email
{
    public function __construct(private string $email)
    {
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
}

// ‚ùå MAL - ValueObject con ID
class Email
{
    private string $id; // ‚ùå No debe tener ID
    private string $email;
}
```

**¬øPor qu√© es importante?**
- **Se identifican** por su valor
- **Son reutilizables** en diferentes contextos
- **No necesitan** persistencia individual
- **Facilitan** la comparaci√≥n

### **2. Son inmutables:**
```php
// ‚úÖ BIEN - Inmutable
class Email
{
    public function __construct(private readonly string $email)
    {
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
    
    public function value(): string
    {
        return $this->email; // Solo lectura
    }
}

// ‚ùå MAL - Mutable
class Email
{
    private string $email;
    
    public function setEmail(string $email): void
    {
        $this->email = $email; // ‚ùå Puede cambiar
    }
}
```

**¬øPor qu√© es importante?**
- **Previenen** cambios accidentales
- **Son seguros** para compartir
- **Facilitan** el testing
- **Mantienen** la consistencia

### **3. Se comparan por valor:**
```php
class Email
{
    public function equals(Email $other): bool
    {
        return $this->email === $other->email; // Compara por valor
    }
}

// Uso
$email1 = new Email('juan@email.com');
$email2 = new Email('juan@email.com');

$email1->equals($email2); // ‚úÖ true - Mismo valor
```

**¬øPor qu√© es importante?**
- **Permiten** comparaciones l√≥gicas
- **Facilitan** la validaci√≥n
- **Mantienen** la consistencia
- **Son predecibles**

---

## ‚ùì ¬øPor qu√© parecen "in√∫tiles"?

### **Lo que ves:**
```php
// Parece que solo "envuelve" un string
class Email
{
    public function __construct(private readonly string $email) {}
    public function value(): string { return $this->email; }
}

// ¬øPara qu√© esto?
$email = new Email('juan@email.com');
echo $email->value(); // 'juan@email.com' - ¬°Igual que el string original!
```

### **Lo que NO ves:**
```php
// El valor real est√° en lo que NO ves
class Email
{
    public function __construct(private readonly string $email)
    {
        // ‚úÖ VALIDACI√ìN AUTOM√ÅTICA
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
    
    public function value(): string { return $this->email; }
    
    // ‚úÖ COMPORTAMIENTO ESPEC√çFICO
    public function domain(): string
    {
        return substr($this->email, strpos($this->email, '@') + 1);
    }
    
    public function localPart(): string
    {
        return substr($this->email, 0, strpos($this->email, '@'));
    }
    
    public function equals(Email $other): bool
    {
        return strtolower($this->email) === strtolower($other->email);
    }
}
```

---

## üöÄ Valor agregado real

### **1. Validaci√≥n autom√°tica:**
```php
// ‚ùå SIN ValueObject - Validaci√≥n manual en cada lugar
class EmployeeController
{
    public function store(Request $request)
    {
        $email = $request->input('email');
        
        // ‚ùå Validaci√≥n manual repetida en cada lugar
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            return response()->json(['error' => 'Invalid email'], 400);
        }
        
        // ‚ùå M√°s validaciones manuales
        if (empty($email)) {
            return response()->json(['error' => 'Email required'], 400);
        }
        
        // ‚ùå Validaci√≥n de duplicados
        if ($this->emailExists($email)) {
            return response()->json(['error' => 'Email exists'], 400);
        }
    }
}

// ‚úÖ CON ValueObject - Validaci√≥n autom√°tica
class EmployeeController
{
    public function store(Request $request)
    {
        try {
            $email = new Email($request->input('email')); // ‚úÖ Validaci√≥n autom√°tica
            // Si llega aqu√≠, el email es v√°lido
        } catch (InvalidEmailException $e) {
            return response()->json(['error' => $e->getMessage()], 400);
        }
    }
}
```

### **2. Comportamiento espec√≠fico del concepto:**
```php
// ‚ùå SIN ValueObject - L√≥gica dispersa
class EmployeeService
{
    public function sendWelcomeEmail(Employee $employee)
    {
        $email = $employee->email;
        
        // ‚ùå L√≥gica de email dispersa por todo el c√≥digo
        $domain = substr($email, strpos($email, '@') + 1);
        $localPart = substr($email, 0, strpos($email, '@'));
        
        if ($domain === 'gmail.com') {
            // L√≥gica espec√≠fica para Gmail
        }
        
        // ‚ùå M√°s l√≥gica de email en otros lugares
        $normalizedEmail = strtolower($email);
        // ...
    }
}

// ‚úÖ CON ValueObject - Comportamiento encapsulado
class EmployeeService
{
    public function sendWelcomeEmail(Employee $employee)
    {
        $email = $employee->email();
        
        // ‚úÖ Comportamiento espec√≠fico del concepto
        if ($email->domain() === 'gmail.com') {
            // L√≥gica espec√≠fica para Gmail
        }
        
        $normalizedEmail = $email->value(); // Ya est√° normalizado
    }
}
```

### **3. Comparaci√≥n segura:**
```php
// ‚ùå SIN ValueObject - Comparaci√≥n manual
class EmployeeService
{
    public function findDuplicateEmails()
    {
        $emails = $this->getAllEmails();
        
        foreach ($emails as $email1) {
            foreach ($emails as $email2) {
                // ‚ùå Comparaci√≥n manual propensa a errores
                if (strtolower(trim($email1)) === strtolower(trim($email2))) {
                    // Encontrado duplicado
                }
            }
        }
    }
}

// ‚úÖ CON ValueObject - Comparaci√≥n segura
class EmployeeService
{
    public function findDuplicateEmails()
    {
        $emails = $this->getAllEmails();
        
        foreach ($emails as $email1) {
            foreach ($emails as $email2) {
                // ‚úÖ Comparaci√≥n segura y consistente
                if ($email1->equals($email2)) {
                    // Encontrado duplicado
                }
            }
        }
    }
}
```

### **4. Prevenci√≥n de errores:**
```php
// ‚ùå SIN ValueObject - Errores comunes
class EmployeeService
{
    public function updateEmployee($employeeId, $newEmail)
    {
        // ‚ùå F√°cil cometer errores
        $employee->email = $newEmail; // ¬øEs v√°lido? ¬øEst√° normalizado?
        
        // ‚ùå F√°cil confundir par√°metros
        $this->sendEmail($employeeId, $newEmail); // ¬øCu√°l es cu√°l?
    }
}

// ‚úÖ CON ValueObject - Prevenci√≥n de errores
class EmployeeService
{
    public function updateEmployee($employeeId, Email $newEmail)
    {
        // ‚úÖ Imposible asignar email inv√°lido
        $employee->updateEmail($newEmail); // Solo acepta Email v√°lido
        
        // ‚úÖ Imposible confundir par√°metros
        $this->sendEmail($employeeId, $newEmail); // Tipos claros
    }
}
```

---

## üìã Casos de uso t√≠picos

### **1. Conceptos de identificaci√≥n:**
```php
class DocumentId
{
    public function __construct(
        private readonly string $type,
        private readonly string $number
    ) {
        $this->validate();
    }
    
    public function type(): string
    {
        return $this->type;
    }
    
    public function number(): string
    {
        return $this->number;
    }
    
    public function equals(DocumentId $other): bool
    {
        return $this->type === $other->type && 
               $this->number === $other->number;
    }
    
    public function toString(): string
    {
        return "{$this->type}-{$this->number}";
    }
    
    private function validate(): void
    {
        if (empty($this->type) || empty($this->number)) {
            throw new InvalidDocumentIdException('Type and number are required');
        }
    }
}
```

### **2. Conceptos de comunicaci√≥n:**
```php
class Email
{
    public function __construct(private readonly string $email)
    {
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
    
    public function value(): string
    {
        return $this->email;
    }
    
    public function domain(): string
    {
        return substr($this->email, strpos($this->email, '@') + 1);
    }
    
    public function localPart(): string
    {
        return substr($this->email, 0, strpos($this->email, '@'));
    }
    
    public function isGmail(): bool
    {
        return $this->domain() === 'gmail.com';
    }
    
    public function isCompany(): bool
    {
        return $this->domain() === 'empresa.com';
    }
    
    public function equals(Email $other): bool
    {
        return strtolower($this->email) === strtolower($other->email);
    }
}
```

### **3. Conceptos de contacto:**
```php
class Phone
{
    public function __construct(private readonly string $phone)
    {
        $this->validate();
    }
    
    public function value(): string
    {
        return $this->phone;
    }
    
    public function formatted(): string
    {
        return preg_replace('/(\d{3})(\d{3})(\d{4})/', '($1) $2-$3', $this->phone);
    }
    
    public function equals(Phone $other): bool
    {
        return $this->normalize($this->phone) === $this->normalize($other->phone);
    }
    
    private function validate(): void
    {
        if (!preg_match('/^\d{10}$/', $this->phone)) {
            throw new InvalidPhoneException('Phone must be 10 digits');
        }
    }
    
    private function normalize(string $phone): string
    {
        return preg_replace('/[^0-9]/', '', $phone);
    }
}
```

### **4. Conceptos de estado:**
```php
enum EmployeeStatus: string
{
    case Active = 'active';
    case Inactive = 'inactive';
    case Suspended = 'suspended';
    case Terminated = 'terminated';
    
    public function isActive(): bool
    {
        return $this === self::Active;
    }
    
    public function canWork(): bool
    {
        return $this === self::Active;
    }
    
    public function displayName(): string
    {
        return match($this) {
            self::Active => 'Activo',
            self::Inactive => 'Inactivo',
            self::Suspended => 'Suspendido',
            self::Terminated => 'Terminado',
        };
    }
}
```

---

## üéØ Casos de uso espec√≠ficos del negocio

### **1. Conceptos monetarios:**
```php
class Money
{
    public function __construct(
        private readonly float $amount,
        private readonly string $currency
    ) {
        $this->validate();
    }
    
    public function amount(): float
    {
        return $this->amount;
    }
    
    public function currency(): string
    {
        return $this->currency;
    }
    
    public function add(Money $other): Money
    {
        if ($this->currency !== $other->currency) {
            throw new CurrencyMismatchException('Cannot add different currencies');
        }
        
        return new Money($this->amount + $other->amount, $this->currency);
    }
    
    public function subtract(Money $other): Money
    {
        if ($this->currency !== $other->currency) {
            throw new CurrencyMismatchException('Cannot subtract different currencies');
        }
        
        return new Money($this->amount - $other->amount, $this->currency);
    }
    
    public function multiply(float $factor): Money
    {
        return new Money($this->amount * $factor, $this->currency);
    }
    
    public function equals(Money $other): bool
    {
        return $this->amount === $other->amount && 
               $this->currency === $other->currency;
    }
    
    public function formatted(): string
    {
        return number_format($this->amount, 2) . ' ' . $this->currency;
    }
    
    private function validate(): void
    {
        if ($this->amount < 0) {
            throw new InvalidMoneyException('Amount cannot be negative');
        }
        
        if (empty($this->currency)) {
            throw new InvalidMoneyException('Currency is required');
        }
    }
}
```

### **2. Conceptos de direcci√≥n:**
```php
class Address
{
    public function __construct(
        private readonly string $street,
        private readonly string $city,
        private readonly string $state,
        private readonly string $zipCode,
        private readonly string $country
    ) {
        $this->validate();
    }
    
    public function street(): string
    {
        return $this->street;
    }
    
    public function city(): string
    {
        return $this->city;
    }
    
    public function fullAddress(): string
    {
        return "{$this->street}, {$this->city}, {$this->state} {$this->zipCode}, {$this->country}";
    }
    
    public function equals(Address $other): bool
    {
        return $this->street === $other->street &&
               $this->city === $other->city &&
               $this->state === $other->state &&
               $this->zipCode === $other->zipCode &&
               $this->country === $other->country;
    }
    
    private function validate(): void
    {
        if (empty($this->street) || empty($this->city)) {
            throw new InvalidAddressException('Street and city are required');
        }
    }
}
```

### **3. Conceptos de fecha:**
```php
class DateRange
{
    public function __construct(
        private readonly DateTimeImmutable $startDate,
        private readonly DateTimeImmutable $endDate
    ) {
        $this->validate();
    }
    
    public function startDate(): DateTimeImmutable
    {
        return $this->startDate;
    }
    
    public function endDate(): DateTimeImmutable
    {
        return $this->endDate;
    }
    
    public function duration(): int
    {
        return $this->startDate->diff($this->endDate)->days;
    }
    
    public function contains(DateTimeImmutable $date): bool
    {
        return $date >= $this->startDate && $date <= $this->endDate;
    }
    
    public function overlaps(DateRange $other): bool
    {
        return $this->startDate <= $other->endDate && 
               $this->endDate >= $other->startDate;
    }
    
    private function validate(): void
    {
        if ($this->startDate > $this->endDate) {
            throw new InvalidDateRangeException('Start date cannot be after end date');
        }
    }
}
```

---

## üîÑ Ciclo de vida en peticiones HTTP

### **Escenario: "Crear un empleado con email y tel√©fono"**

#### **1. Usuario hace petici√≥n HTTP:**
```http
POST /api/employees
Content-Type: application/json
Authorization: Bearer token123

{
    "first_name": "Juan",
    "last_name": "P√©rez",
    "email": "juan.perez@empresa.com",
    "phone": "1234567890",
    "document_type": "CC",
    "document_number": "12345678"
}
```

#### **2. Controller recibe la petici√≥n:**
```php
// app/Modules/Employees/Infrastructure/Http/Controllers/EmployeeController.php
class EmployeeController extends Controller
{
    public function store(Request $request)
    {
        // 1. Crear Command con datos de la petici√≥n
        $command = new CreateEmployeeCommand(
            firstName: $request->input('first_name'),
            lastName: $request->input('last_name'),
            email: $request->input('email'),           // ‚úÖ String primitivo
            phone: $request->input('phone'),           // ‚úÖ String primitivo
            documentType: $request->input('document_type'),
            documentNumber: $request->input('document_number')
        );
        
        // 2. Pasar Command al Handler
        $handler = app(CreateEmployeeHandler::class);
        $dto = $handler->handle($command);
        
        // 3. Retornar respuesta HTTP
        return response()->json(['data' => $dto->toArray()]);
    }
}
```

#### **3. Handler procesa el Command:**
```php
// app/Modules/Employees/Application/Handlers/CreateEmployeeHandler.php
class CreateEmployeeHandler
{
    public function __construct(
        private EmployeeService $employeeService
    ) {}
    
    public function handle(CreateEmployeeCommand $command): EmployeeDTO
    {
        // 1. Crear ValueObjects desde strings primitivos
        $email = new Email($command->email);                    // ‚úÖ String ‚Üí Email ValueObject
        $phone = new Phone($command->phone);                    // ‚úÖ String ‚Üí Phone ValueObject
        $document = new DocumentId($command->documentType, $command->documentNumber); // ‚úÖ String ‚Üí DocumentId ValueObject
        
        // 2. Crear Entity con ValueObjects
        $employee = new Employee(
            id: Str::uuid(),
            firstName: $command->firstName,
            lastName: $command->lastName,
            email: $email,                                      // ‚úÖ Email ValueObject
            phone: $phone,                                      // ‚úÖ Phone ValueObject
            document: $document                                 // ‚úÖ DocumentId ValueObject
        );
        
        // 3. Usar Service del Domain
        $this->employeeService->validateEmployee($employee);
        
        // 4. Persistir Entity
        $this->employeeRepository->save($employee);
        
        // 5. Crear DTO de respuesta
        return new EmployeeDTO(
            id: $employee->id(),
            firstName: $employee->firstName(),
            lastName: $employee->lastName(),
            email: $employee->email()->value(),                 // ‚úÖ Email ValueObject ‚Üí String
            phone: $employee->phone()->value(),                 // ‚úÖ Phone ValueObject ‚Üí String
            document: $employee->document()->toString()         // ‚úÖ DocumentId ValueObject ‚Üí String
        );
    }
}
```

#### **4. Transformaciones de datos durante el flujo:**

**1. HTTP Request ‚Üí Command:**
```php
// String primitivo ‚Üí String primitivo
"juan.perez@empresa.com" ‚Üí $command->email
```

**2. Command ‚Üí ValueObjects:**
```php
// String primitivo ‚Üí ValueObject
$command->email ‚Üí new Email($command->email)
```

**3. ValueObjects ‚Üí Entity:**
```php
// ValueObjects ‚Üí Entity properties
new Email($command->email) ‚Üí $employee->email
```

**4. Entity ‚Üí Repository:**
```php
// ValueObjects ‚Üí String primitivos para persistencia
$employee->email()->value() ‚Üí $model->email
```

**5. Repository ‚Üí Entity:**
```php
// String primitivos ‚Üí ValueObjects
$model->email ‚Üí new Email($model->email)
```

**6. Entity ‚Üí DTO:**
```php
// ValueObjects ‚Üí String primitivos para respuesta
$employee->email()->value() ‚Üí $dto->email
```

#### **5. Flujo visual del proceso:**
```
1. HTTP Request (String) 
   ‚Üì
2. Controller (String)
   ‚Üì
3. Command (String)
   ‚Üì
4. Handler ‚Üí ValueObjects (Email, Phone, DocumentId)
   ‚Üì
5. Entity (ValueObjects)
   ‚Üì
6. Service (ValueObjects)
   ‚Üì
7. Repository (ValueObjects ‚Üí String para DB)
   ‚Üì
8. Database (String)
   ‚Üì
9. Repository (String ‚Üí ValueObjects)
   ‚Üì
10. Entity (ValueObjects)
    ‚Üì
11. DTO (ValueObjects ‚Üí String)
    ‚Üì
12. HTTP Response (String)
```

---

## ‚úÖ Mejores pr√°cticas

### **1. Inmutabilidad:**
```php
// ‚úÖ BIEN - Inmutable
class Email
{
    public function __construct(private readonly string $email)
    {
        $this->validate();
    }
    
    public function value(): string
    {
        return $this->email; // Solo lectura
    }
}

// ‚ùå MAL - Mutable
class Email
{
    private string $email;
    
    public function setEmail(string $email): void
    {
        $this->email = $email; // ‚ùå Puede cambiar
    }
}
```

### **2. Validaci√≥n en constructor:**
```php
// ‚úÖ BIEN - Validaci√≥n en constructor
class Email
{
    public function __construct(private readonly string $email)
    {
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
}

// ‚ùå MAL - Sin validaci√≥n
class Email
{
    public function __construct(private readonly string $email)
    {
        // ‚ùå No valida el formato
    }
}
```

### **3. M√©todo equals:**
```php
// ‚úÖ BIEN - M√©todo equals
class Email
{
    public function equals(Email $other): bool
    {
        return strtolower($this->email) === strtolower($other->email);
    }
}

// ‚ùå MAL - Sin m√©todo equals
class Email
{
    // ‚ùå No se puede comparar
}
```

### **4. M√©todos de utilidad:**
```php
// ‚úÖ BIEN - M√©todos √∫tiles
class Email
{
    public function domain(): string
    {
        return substr($this->email, strpos($this->email, '@') + 1);
    }
    
    public function localPart(): string
    {
        return substr($this->email, 0, strpos($this->email, '@'));
    }
    
    public function isGmail(): bool
    {
        return $this->domain() === 'gmail.com';
    }
}

// ‚ùå MAL - Solo getter b√°sico
class Email
{
    public function value(): string
    {
        return $this->email; // ‚ùå Solo retorna el valor
    }
}
```

### **5. Nombres descriptivos:**
```php
// ‚úÖ BIEN - Nombres descriptivos
class Email
class Phone
class DocumentId
class Money

// ‚ùå MAL - Nombres gen√©ricos
class StringValue
class Data
class Info
```

---

## üß™ Testing de ValueObjects

### **Test b√°sico:**
```php
// tests/Unit/Domain/ValueObjects/EmailTest.php
class EmailTest extends TestCase
{
    public function test_creates_email_with_valid_format(): void
    {
        $email = new Email('juan@email.com');
        
        $this->assertEquals('juan@email.com', $email->value());
    }
    
    public function test_throws_exception_with_invalid_format(): void
    {
        $this->expectException(InvalidEmailException::class);
        $this->expectExceptionMessage('Invalid email format');
        
        new Email('invalid-email');
    }
    
    public function test_equals_returns_true_for_same_email(): void
    {
        $email1 = new Email('juan@email.com');
        $email2 = new Email('juan@email.com');
        
        $this->assertTrue($email1->equals($email2));
    }
    
    public function test_equals_returns_false_for_different_email(): void
    {
        $email1 = new Email('juan@email.com');
        $email2 = new Email('maria@email.com');
        
        $this->assertFalse($email1->equals($email2));
    }
    
    public function test_domain_returns_correct_domain(): void
    {
        $email = new Email('juan@email.com');
        
        $this->assertEquals('email.com', $email->domain());
    }
    
    public function test_local_part_returns_correct_local_part(): void
    {
        $email = new Email('juan@email.com');
        
        $this->assertEquals('juan', $email->localPart());
    }
    
    public function test_is_gmail_returns_true_for_gmail(): void
    {
        $email = new Email('juan@gmail.com');
        
        $this->assertTrue($email->isGmail());
    }
    
    public function test_is_gmail_returns_false_for_non_gmail(): void
    {
        $email = new Email('juan@empresa.com');
        
        $this->assertFalse($email->isGmail());
    }
}
```

---

## üîó Relaci√≥n con otras capas

### **1. Con Entities:**
```php
// Entities usan ValueObjects
class Employee
{
    public function __construct(
        private string $id,
        private string $firstName,
        private string $lastName,
        private Email $email,           // ‚úÖ ValueObject
        private Phone $phone,           // ‚úÖ ValueObject
        private DocumentId $document    // ‚úÖ ValueObject
    ) {}
}
```

### **2. Con Services:**
```php
// Services usan ValueObjects
class EmployeeService
{
    public function validateEmployee(Employee $employee): void
    {
        if ($this->emailExists($employee->email())) {
            throw new EmployeeAlreadyExistsException();
        }
    }
    
    private function emailExists(Email $email): bool
    {
        return $this->employeeRepository->findByEmail($email) !== null;
    }
}
```

### **3. Con Repositories:**
```php
// Repositories usan ValueObjects
interface EmployeeRepositoryInterface
{
    public function findByEmail(Email $email): ?Employee;
    public function findByDocument(DocumentId $document): ?Employee;
}
```

---

## üíª Ejemplos pr√°cticos

### **Ejemplo 1: ValueObject Email completo**
```php
// app/Modules/Employees/Domain/ValueObjects/Email.php
final class Email
{
    public function __construct(private readonly string $email)
    {
        $this->validate();
    }
    
    public function value(): string
    {
        return $this->email;
    }
    
    public function domain(): string
    {
        return substr($this->email, strpos($this->email, '@') + 1);
    }
    
    public function localPart(): string
    {
        return substr($this->email, 0, strpos($this->email, '@'));
    }
    
    public function isGmail(): bool
    {
        return $this->domain() === 'gmail.com';
    }
    
    public function isCompany(): bool
    {
        return $this->domain() === 'empresa.com';
    }
    
    public function equals(Email $other): bool
    {
        return strtolower($this->email) === strtolower($other->email);
    }
    
    public function __toString(): string
    {
        return $this->email;
    }
    
    private function validate(): void
    {
        if (empty($this->email)) {
            throw new InvalidEmailException('Email cannot be empty');
        }
        
        if (!filter_var($this->email, FILTER_VALIDATE_EMAIL)) {
            throw new InvalidEmailException('Invalid email format');
        }
    }
}
```

### **Ejemplo 2: ValueObject Money completo**
```php
// app/Modules/Employees/Domain/ValueObjects/Money.php
final class Money
{
    public function __construct(
        private readonly float $amount,
        private readonly string $currency
    ) {
        $this->validate();
    }
    
    public function amount(): float
    {
        return $this->amount;
    }
    
    public function currency(): string
    {
        return $this->currency;
    }
    
    public function add(Money $other): Money
    {
        if ($this->currency !== $other->currency) {
            throw new CurrencyMismatchException('Cannot add different currencies');
        }
        
        return new Money($this->amount + $other->amount, $this->currency);
    }
    
    public function subtract(Money $other): Money
    {
        if ($this->currency !== $other->currency) {
            throw new CurrencyMismatchException('Cannot subtract different currencies');
        }
        
        return new Money($this->amount - $other->amount, $this->currency);
    }
    
    public function multiply(float $factor): Money
    {
        return new Money($this->amount * $factor, $this->currency);
    }
    
    public function divide(float $divisor): Money
    {
        if ($divisor === 0) {
            throw new DivisionByZeroException('Cannot divide by zero');
        }
        
        return new Money($this->amount / $divisor, $this->currency);
    }
    
    public function equals(Money $other): bool
    {
        return $this->amount === $other->amount && 
               $this->currency === $other->currency;
    }
    
    public function formatted(): string
    {
        return number_format($this->amount, 2) . ' ' . $this->currency;
    }
    
    public function isZero(): bool
    {
        return $this->amount === 0.0;
    }
    
    public function isPositive(): bool
    {
        return $this->amount > 0;
    }
    
    public function isNegative(): bool
    {
        return $this->amount < 0;
    }
    
    private function validate(): void
    {
        if ($this->amount < 0) {
            throw new InvalidMoneyException('Amount cannot be negative');
        }
        
        if (empty($this->currency)) {
            throw new InvalidMoneyException('Currency is required');
        }
        
        if (!in_array($this->currency, ['USD', 'EUR', 'COP'])) {
            throw new InvalidMoneyException('Unsupported currency');
        }
    }
}
```

---

## üéØ ¬øCu√°ndo usar ValueObjects?

### **‚úÖ S√ç usar ValueObjects cuando:**
- **Representas** conceptos del negocio
- **No necesitas** identidad √∫nica
- **Quieres** validaci√≥n autom√°tica
- **Necesitas** comparaci√≥n por valor
- **Quieres** inmutabilidad
- **Tienes** l√≥gica espec√≠fica del concepto

### **‚ùå NO usar ValueObjects cuando:**
- **Necesitas** identidad √∫nica (usa Entity)
- **Solo necesitas** tipos primitivos simples
- **No hay l√≥gica** de validaci√≥n
- **Es un prototipo** simple
- **No hay comportamiento** espec√≠fico

---

## üéØ Resumen

### **üéØ ValueObjects son:**
- **Objetos** que representan conceptos del negocio
- **Sin identidad** √∫nica
- **Inmutables** (no cambian)
- **Se comparan** por valor
- **Reutilizables** y seguros

### **üéØ Para qu√© sirven:**
- Representar conceptos del negocio
- Validar datos autom√°ticamente
- Facilitar la comparaci√≥n
- Mantener la inmutabilidad
- Mejorar la expresividad del c√≥digo
- Prevenir errores comunes

### **üìã Caracter√≠sticas clave:**
- Sin identidad √∫nica
- Inmutables
- Se comparan por valor
- Validaci√≥n en constructor
- M√©todos de utilidad espec√≠ficos

### **‚úÖ Mejores pr√°cticas:**
- Inmutabilidad
- Validaci√≥n en constructor
- M√©todo equals
- M√©todos de utilidad
- Nombres descriptivos

### **üöÄ Valor agregado real:**
- **Validaci√≥n autom√°tica** - Una vez, en un lugar
- **Comportamiento espec√≠fico** - L√≥gica del concepto encapsulada
- **Comparaci√≥n segura** - Maneja casos edge autom√°ticamente
- **Prevenci√≥n de errores** - Imposible usar datos inv√°lidos
- **Expresividad** - C√≥digo m√°s claro y legible
- **Mantenibilidad** - Cambios en un solo lugar

### **üîÑ En el ciclo de vida de peticiones HTTP:**
1. **Entrada**: Strings primitivos del HTTP
2. **Transformaci√≥n**: Strings ‚Üí ValueObjects
3. **Procesamiento**: ValueObjects en toda la l√≥gica de negocio
4. **Persistencia**: ValueObjects ‚Üí Strings para base de datos
5. **Recuperaci√≥n**: Strings ‚Üí ValueObjects desde base de datos
6. **Salida**: ValueObjects ‚Üí Strings para HTTP response

**¬°Los ValueObjects son el puente entre los datos primitivos del HTTP y los conceptos ricos del dominio, aportando validaci√≥n autom√°tica, comportamiento espec√≠fico y prevenci√≥n de errores!** üöÄ
